<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>日経サイエンス バックナンバーの検索</title>
    <link rel="stylesheet" type="text/css" href="magindex.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" src="magindex.js"></script>

  </head>
  <body>
    <h2 align="center">-検索トップページ-</h2>
    <hr size="1" />

    <form method="post" action="nik_kensaku.php">
      <div id="kensaku_main">

	       <div id="kensaku_form">
           <table border="1" align="center">
             <tbody>
               <tr>
                 <td>ジャンル(分野)</td>
                 <td>
                   <select name="genre[]" multiple>
                     <option value="111" selected>全分野</option>
                     <?php
                     setlocale(LC_ALL, 'ja_JP.UTF-8');
                     $genre_file = "genre.txt";
                     $home_dir = "/home/s1781061/my_www/mag_sys/";

                     //まずジャンルファイルから現在のジャンルを読み込む

                     $fp = fopen($home_dir . $genre_file, "r");
                     while ($data = fgetcsv($fp, 1000, ",")){
                       print "<option value=\"" . $data[0] . "\">" . $data[1] . "</option>";
                     }
                     fclose($fp);
                     ?>
                   </select>
                 </td>
               </tr>

               <tr>
                 <td>発行年月</td>
                 <td>
                   <?php
                   setlocale(LC_ALL,'ja_JP.UTF-8');
                   $zashi_file = "nikkei_science.txt";
                   $year = array();
                   $month = array();

                   $fp2 = fopen($home_dir . $zashi_file,"r");

                   while($data = fgetcsv($fp2,1000,",")){
                     if(!in_array($data[2],$year)){      //既に存在するデータは配列に加えない
                       array_push($year,$data[2]);        //配列の末尾に追加
                     }

                     if(!in_array($data[3],$month)){
                       array_push($month,$data[3]);
                     }
                   }

                   rsort($year);                            //配列を降順にソート
                   sort($month);                            //配列を昇順にソート

                   print('<select name="year">' . "\n");  //年
                   print('<option value="0" selected>Select</option>' . "\n");
                   for($i=0;$i<count($year);$i++) {
                     print "<option value=\"". $year[$i] . "\">". $year[$i] . "</option>";
                   }
                   print("</select>年\n");

                   print('<select name="month">' . "\n");  //月
                   print('<option value="0" selected>Select</option>' . "\n");
                   for($i=0;$i<count($month);$i++) {
                     print "<option value=\"". $month[$i] . "\">". $month[$i] . "</option>";
                   }
                   print("</select>月\n");

                   fclose($fp2);
                   ?>
                 </td>
               </tr>

               <tr>
                 <td>キーワード入力</td>
                 <td>
                   <input type="text" name="keyword" value="" size="35">
                 </td>
               </tr>

               <tr>
                 <td>検索オプション</td>
                 <td>
                   <input type="radio" name="andor" value="and" checked>And(すべてにキーワードを含む)
                   <br>
                   <input type="radio" name="andor" value="or">Or(キーワードのどれかを含む)
                 </td>
               </tr>

               <tr>
                 <td height="35" colspan="2" align="right">
                   <input type="submit" value="検索">
                   <input type="reset" value="リセット">
                 </td>
               </tr>
             </tbody>
           </table>
         </div>


         <div id="kensaku_des">
           <dl>
             <dt>ジャンルの選択</dt>
             <dd>検索ジャンルを選択可能。Shiftキーを押しながら連続した複数個のジャンルを選択できる。また、Ctrlキーを押しながら選択すると不連続の複数ジャンル選択ができる。</dd>

             <dt>キーワード</dt>
             <dd>複数のキーワードをスペース(コンマ、全角スペース、タブなどでも可)で区切って与える</dd>

             <dt>検索オプション</dt>
             <dd>複数のキーワードが与えられたとき、検索方式を決める。すべてのキーワードを雑誌名に含むように検索するとき、andを選択する。キーワードの一つでも雑誌名に含む項目を検索のとき、orを選択する。</dd>
           </dl>
         </div>

       </div>
     </from>
     <hr size="1" />
   </body>
</html>
